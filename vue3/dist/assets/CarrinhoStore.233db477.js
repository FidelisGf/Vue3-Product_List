import{au as p,aq as u,u as a,ar as o}from"./index.68037d06.js";const d={checkIfHasEstoque(t,s){return p.get("/getQuantidadeProduct/"+t,{params:{COR:s}})}},D=u("carrinho",{state:()=>({itens:[],id_pedido:0}),persist:!0,actions:{async saveInCarrinho(t){const s=a(),e=this.itens.filter(i=>i.ID==t.ID);let n={ID:t.ID,QUANTIDADE:1,VALOR:t.VALOR,COR:t.COR};if(e){const i=e.find(r=>r.COR==t.COR);if(i){const r=await d.checkIfHasEstoque(t.ID,t.COR).then(c=>c.data).catch(c=>c);if(i.QUANTIDADE+1>r){s.activeSnack("Estoque insuficiente !");return}else i.QUANTIDADE+=1}else this.itens.push(n)}else this.itens.push(n);s.activeSnack("Item adicionado ao carrinho"),console.log(this.itens)},async getCupomDesc(t){const s=a();return o.get("cupons",t).then(n=>(s.activeSnack("Cupom Aplicado com sucesso !"),n.data)).catch(n=>(s.activeSnack("Error : "+n.response.data.message),null))},async applyCupomDesc(t){const s=a();o.post("cupons",t).then(()=>{}).catch(e=>{s.activeSnack("Error : "+e.response.data.message)})},async addQuantidadeProduto(t){const s=a(),e=this.itens[t];if(e){const n=await d.checkIfHasEstoque(e.ID,e.COR).then(i=>i.data).catch(i=>i);if(e.QUANTIDADE+1>n)return s.activeSnack("Estoque insuficiente !"),"Error";e.QUANTIDADE+=1}return s.activeSnack("Item adicionado ao carrinho"),"Success"},removeQuantidadeProduto(t){const s=this.itens[t];s&&(s.QUANTIDADE==1?this.itens=this.itens.filter(n=>n!=s):s.QUANTIDADE-=1),a().activeSnack("Item removido do carrinho")},async getProdutosCarrinho(){let t=[],s={Shop:"T"};for(const e of this.itens)await o.findById("products",e.ID,s).then(n=>{e.QUANTIDADE>n.data.ESTOQUE&&(e.QUANTIDADE="Indisponivel");let i=n.data;i.QUANTIDADE=e.QUANTIDADE,i.COR_ESCOLHIDA=e.COR,t.push(i)});return t},removeIndisponivel(t){const s=this.itens[t];this.itens=this.itens.filter(n=>n!=s),a().activeSnack("Item removido do carrinho")},async finalizarPedido(t){const s=a();let e=new FormData,n=JSON.stringify(this.itens);t.ID!=null&&e.append("ID_CUPOM",t.ID),e.append("PRODUTOS",n),e.append("aprovado","F"),e.append("METODO_PAGAMENTO","Dinheiro");const i=await o.post("pedidosInternet",e).then(r=>r.data).catch(r=>r);s.activeSnack(i.message),this.id_pedido=i.data,this.itens=[]}},getters:{getCountCarrinho(){return Object.keys(this.itens).length<0||Object.keys(this.itens).length==null?0:Object.keys(this.itens).length},getIdPedido(){return this.id_pedido}}});export{D as u};
